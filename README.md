# TreeRings

The TreeRings project is under development by students in the Temporal Ecology Lab at UBC. The project aims to create an open source and reproducible system to digitize ultra high resolution images of tree cookies. This is accomplished with a robot having control of a microscope camera that can navigate the X, Y, and Z directions. By systematically capturing images across the surface of the cookie, it is possible to stitch subframes of the cookie together into one large mosaic with the help of feature matching techniques. 

While this was designed to capture tree cookies, in theory this should also be able to be used to scan other planar objects such as planed mineral samples or pencil drawings. 

## Current Functionality

![Tina](./docs/content/tina.jpg)

- Image capture and stitching of the surface of a tree cookie into a single mosaic
- Memory efficient image stitching (stitching images greater than available device RAM)
- Multiple mosaic resolutions for one set of images
- Data storage in .dat files to be used with a custom image viewer to view a subset of the image without loading into RAM

## Current Problems

- Larger cookies (> 25cm in diameter) are more difficult to sand uniformly, resulting in poor stitching
- Larger cookies are less functional then smaller cookies as the filesizes can become prohibitively large
- Stochastic insufficient system memory while capturing for long periods of time (large cookies or many cookies)

## Getting Started TODO

These instructions will get you a copy of the project up and running on your local machine for development and testing purposes. See deployment for notes on how to deploy the project on a live system.

### Prerequisites / Equipment

| Item                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Cost per unit CAD   | Material Type |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------- | ------------- |
| FDM 3D Printer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Many components are 3D printed to allow for rapid prototyping. Printing quality varies across platforms and materials. Choose what is best for your lab - our parts were made with a [Bambu Carbon X1](https://ca.store.bambulab.com/products/x1-carbon?variant=46286179270896&currency=CAD&utm_medium=product_sync&utm_source=google&utm_content=sag_organic&utm_campaign=sag_organic&gad_source=1&gclid=Cj0KCQjww5u2BhDeARIsALBuLnPN2AA2AAOx9SfhR0Slt6G1aFqrriQxQIsDFw2W-HsvmBLvWzmlFU4aAoNQEALw_wcB) printer. | $1900               | Equipment     |
| [Jetson Orin Nano](https://www.seeedstudio.com/NVIDIAr-Jetson-Orintm-Nano-Developer-Kit-p-5617.html?gad_source=1&gclid=Cj0KCQjww5u2BhDeARIsALBuLnM4tGqXsBM7JNxW5mwzGraFG74Qjp_JeM_HpbXGEc9Mlnl9b1s2fv8aAsPREALw_wcB)                                                                                                                                                                                                                                                                                                      | This acts as the main computing device, running the GUI, stitching software, driving the camera, etc.                                                                                                                                                                                                                                                                                                                                                                                                            | $879                | Computer      |
| [1 TB NVME SSD](https://www.amazon.ca/dp/B09QV692XY?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                                    | For storage on the Jetson.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | $99                 | Computer      |
| [OpenBuilds Acro](https://us.openbuilds.com/openbuilds-acro-1010-40-x-40/)                                                                                                                                                                                                                                                                                                                                                                                                                                                | The chassis for the gantry robot has already been designed and greatly documented by OpenBuilds. Building on top of this system has many benefits such as a library of documentation and customer service!                                                                                                                                                                                                                                                                                                       | $497 USD. ~$700 CAD | Frame         |
| [OpenBuilds BlackBox X32](https://openbuildspartstore.com/BlackBox-Motion-Control-System-X32)                                                                                                                                                                                                                                                                                                                                                                                                                             | The motor controller to convert G-Code commands into electrical signals for the stepper motors. This was originally an Arduino - with a CNC hat and GRBL firmware. Sadly this quickly became a mess of wires and lacked the robust and clean wiring that the BlackBox has out of the box.                                                                                                                                                                                                                        | $333 USD ~$470 CAD  | Computer      |
| [OpenBuilds NEMA17 Linear  Actuator 250mm (Lead Screw)](https://us.openbuilds.com/v-slot-nema-17-linear-actuator-bundle-lead-screw/)                                                                                                                                                                                                                                                                                                                                                                                      | Linear actuator to control the Z axis of the machine.                                                                                                                                                                                                                                                                                                                                                                                                                                                            | $170 USD ~$240 CAD  | Frame         |
| [Raspberry Pi HQ Camera](https://www.digikey.ca/en/products/detail/raspberry-pi/SC1220/12339164?utm_adgroup=&utm_source=google&utm_medium=cpc&utm_campaign=PMax%20Product_Low%20ROAS%20Categories&utm_term=&productid=12339164&utm_content=&utm_id=go_cmp-20291741422_adg-_ad-__dev-c_ext-_prd-12339164_sig-Cj0KCQjww5u2BhDeARIsALBuLnPqCH09hu75KK18zBjZjUBQatUt-5BTpTnjI5q8qJso41ViaZUtn34aAnrvEALw_wcB&gad_source=1&gclid=Cj0KCQjww5u2BhDeARIsALBuLnPqCH09hu75KK18zBjZjUBQatUt-5BTpTnjI5q8qJso41ViaZUtn34aAnrvEALw_wcB) | The Raspberry Pi HQ camera is guaranteed to be made for a few more years. It is also a cheap and convenient alternative to a professional camera. Although this lacks built in autofocus, making the control of the system long.                                                                                                                                                                                                                                                                                 | $78.28              | Camera        |
| [Seeed Studio 100x C-Mount Lens](https://www.mouser.ca/ProductDetail/Seeed-Studio/114992279?qs=sPbYRqrBIVkEZBNsZalWRw%3D%3D&mgh=1&utm_id=17633666059&gad_source=1&gclid=Cj0KCQjww5u2BhDeARIsALBuLnODICm5ko0IUJuMAPNL5cLVtKh6Wy707Y80PBOfuO5cLn4FYl5yqvsaAvkBEALw_wcB)                                                                                                                                                                                                                                                     | This lens has variable focal lengths allowing for easy adjustment of amount of the detail desired while capturing the images.                                                                                                                                                                                                                                                                                                                                                                                    | $101.5              | Camera        |
| [Ring light for lens](https://www.amazon.ca/dp/B0B1JQLXG7?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                                              | Conveniently fits on the Seeed studio lens                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | $40                 | Camera        |
| USB / Wireless Keyboard                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Generic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | $30                 | Interface     |
| USB / Wireless Mouse                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Generic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | $30                 | Interface     |
| USBC Flash Drive                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Generic, for transferring files from the device to your main computer. Good to have 256GB +                                                                                                                                                                                                                                                                                                                                                                                                                      | $40                 | Interface     |
| [Display Port to HDMI adapter](https://www.amazon.ca/dp/B07ZNNRYFL?ref=nb_sb_ss_w_as-reorder_k1_1_19&amp=&crid=1A3SR8HZ8W838&sprefix=display%2Bport%2Bto%2Bhdm&th=1)                                                                                                                                                                                                                                                                                                                                                      | Any adapter should work if using a HDMI monitor                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | $15                 | Interface     |
| Monitor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Computer monitor of some sort to use the GUI.                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | $100                | Interface     |
| 3m HDMI Cord                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Generic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | $15                 | Interface     |
| 3m USB-B to USB-A Cord                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Generic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | $15                 | Interface     |
| [Corner brackets](https://www.amazon.ca/dp/B09YGJMNBP?ref=ppx_yo2ov_dt_b_fed_asin_title&th=1) for aluminum extrusion                                                                                                                                                                                                                                                                                                                                                                                                      | Used for making stronger, and taller legs for the Acro. Need at least four 2020 aluminum extrusion corner brackets. It's best for them to have long extensions.                                                                                                                                                                                                                                                                                                                                                  | $30                 | Frame         |
| [20mm x 20mm x 250mm V-Slot Aluminum](https://www.amazon.ca/dp/B0CL49ZGZX?ref=ppx_yo2ov_dt_b_fed_asin_title)                                                                                                                                                                                                                                                                                                                                                                                                              | Used for extending the height of the Acro. Need four pieces. Can be any V slot extrusion.                                                                                                                                                                                                                                                                                                                                                                                                                        | $40                 | Frame         |
| [M3 M4 M5 Hammer Head Drop in T Nuts](https://www.amazon.ca/YMAISS-195Pcs-Assortment-Aluminum-Profile/dp/B0BL1F55S5?pd_rd_w=8S5QH&content-id=amzn1.sym.ffb3ec7b-f4ff-4f0b-9941-80eb445d59e0&pf_rd_p=ffb3ec7b-f4ff-4f0b-9941-80eb445d59e0&pf_rd_r=MSGJ043DF5WV8KTZNHBA&pd_rd_wg=OEc95&pd_rd_r=55495543-7107-4e8a-8cb5-68b528ea311e&pd_rd_i=B0BL1F55S5&psc=1&ref_=pd_bap_d_grid_rp_0_24_t) | Used to attach adapters to aluminum extrusion. | $16 | Frame |  
| [Metric Lock Nut Assortment](https://www.amazon.ca/Swpeet-100Pcs-Stainless-Assortment-Locknut/dp/B07VPDZ2KJ?pd_rd_w=0fYW5&content-id=amzn1.sym.dfe4a08c-5f84-4843-8949-98bd6055875f&pf_rd_p=dfe4a08c-5f84-4843-8949-98bd6055875f&pf_rd_r=AGQMF5HGSP75ZH2T3RAC&pd_rd_wg=oIS95&pd_rd_r=4226f91e-26f0-4632-8d19-9dfefd0a0387&pd_rd_i=B07VPDZ2KJ&psc=1&ref_=pd_basp_d_rpt_ba_s_2_t) | Used for adapter assembly | $14.99 | Frame |
| [Metric Nuts and Bolts Assortment](https://www.amazon.ca/1700PCS-Metric-Nuts-Bolts-Assortment/dp/B0C6ZYVF32?pd_rd_w=0fYW5&content-id=amzn1.sym.dfe4a08c-5f84-4843-8949-98bd6055875f&pf_rd_p=dfe4a08c-5f84-4843-8949-98bd6055875f&pf_rd_r=AGQMF5HGSP75ZH2T3RAC&pd_rd_wg=oIS95&pd_rd_r=4226f91e-26f0-4632-8d19-9dfefd0a0387&pd_rd_i=B0C6ZYVF32&ref_=pd_basp_d_rpt_ba_s_3_t&th=1) | Used for adapter assembly | $29.99 | Frame |
| Total                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | $2,983              |               |



### Installing TODO

A step by step series of examples that tell you how to get a development env running

Say what the step will be

```
Give the example
```

And repeat

```
until finished
```

End with an example of getting some data out of the system or using it for a little demo

## Running the tests TODO

Explain how to run the automated tests for this system

### Break down into end to end tests TODO

Explain what these tests test and why

```
Give an example
```

### And coding style tests TODO 

Explain what these tests test and why

```
Give an example
```

## Deployment TODO

Add additional notes about how to deploy this on a live system

## Built With TODO

* [Dropwizard](http://www.dropwizard.io/1.0.2/docs/) - The web framework used
* [Maven](https://maven.apache.org/) - Dependency Management
* [ROME](https://rometools.github.io/rome/) - Used to generate RSS Feeds

## Contributing TODO

Please read [CONTRIBUTING.md](https://gist.github.com/PurpleBooth/b24679402957c63ec426) for details on our code of conduct, and the process for submitting pull requests to us.

## Versioning TODO 

We use [SemVer](http://semver.org/) for versioning. For the versions available, see the [tags on this repository](https://github.com/your/project/tags). 

## Authors TODO

* **Billie Thompson** - *Initial work* - [PurpleBooth](https://github.com/PurpleBooth)

See also the list of [contributors](https://github.com/your/project/contributors) who participated in this project.

## License TODO

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details

## Acknowledgments TODO

* Hat tip to anyone whose code was used
* Inspiration
* etc

## Serpentine G-Code Control Logic
![Control Logic](./docs/diagrams/G_code_serpentine_logic.png)
![Live Demo](./docs/content/serpentine_example.gif)
